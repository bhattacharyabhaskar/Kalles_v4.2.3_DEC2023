{% for product in collection.products %}
  {% assign has_inventory = false %}

  <!-- Loop through all variants -->
  {% for variant in product.variants %}
    {% if variant.inventory_quantity > 0 %}
      {% assign has_inventory = true %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if has_inventory %}
    <!-- ✅ Product is in stock, proceed -->
    <url>
      <loc>{{ shop.url }}{{ product.url }}</loc>
      {% for media in product.media %}
        {% if media.media_type == 'video' or media.media_type == 'external_video' %}
          <video:video>
            <video:thumbnail_loc>{{ media.preview_image | image_url: width: 800 }}</video:thumbnail_loc>
            <video:title><![CDATA[{{ product.title }}]]></video:title>
            <video:description><![CDATA[{{ product.description | strip_html | truncate: 200 }}]]></video:description>
            <video:content_loc>{{ media.sources[0].url }}</video:content_loc>
            <video:player_loc>{{ media.sources[0].url }}?autoplay=1</video:player_loc>
            <video:publication_date>{{ product.created_at | date: "%Y-%m-%dT%H:%M:%SZ" }}</video:publication_date>
          </video:video>
        {% endif %}
      {% endfor %}
    </url>
  {% else %}
    <!-- ❌ Skipping product: No inventory -->
    <!-- Skipping product: {{ product.title }} (Inventory 0) -->
  {% endif %}
{% endfor %}
